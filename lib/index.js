(function(l,d){typeof exports=="object"&&typeof module<"u"?d(exports):typeof define=="function"&&define.amd?define(["exports"],d):(l=typeof globalThis<"u"?globalThis:l||self,d(l.Transferables={}))})(this,function(l){"use strict";const d=Object.getPrototypeOf(Int8Array),p=globalThis.AudioData,T=globalThis.VideoFrame,b=globalThis.OffscreenCanvas,w=globalThis.RTCDataChannel;async function C(){const a=await(async()=>{try{const t=new MessageChannel,n={channel:new MessageChannel};structuredClone(n,{transfer:[n.channel.port1,n.channel.port2]});const r={channel:new MessageChannel};await new Promise(s=>{t.port1.start(),t.port2.start(),t.port1.postMessage(r,[r.channel.port1,r.channel.port2]),t.port1.onmessage=()=>{t.port1.close(),s()},t.port2.onmessage=({data:e})=>{t.port2.postMessage(e,[e.channel.port1,e.channel.port2])}})}catch(t){return console.warn(t),!1}return!0})(),f=await(async()=>{try{const t=new MessageChannel,n={readonly:new ReadableStream,writeonly:new WritableStream,tranformonly:new TransformStream};structuredClone(n,{transfer:[n.readonly,n.writeonly,n.tranformonly]});const r={readonly:new ReadableStream,writeonly:new WritableStream,tranformonly:new TransformStream};await new Promise(s=>{t.port1.start(),t.port2.start(),t.port1.postMessage(r,[r.readonly,r.writeonly,r.tranformonly]),t.port1.onmessage=()=>{t.port1.close(),s()},t.port2.onmessage=({data:e})=>{t.port2.postMessage(e,[e.readonly,e.writeonly,e.tranformonly])}})}catch(t){return console.warn(t),!1}return!0})();return{channel:a,streams:f}}function h(a){return typeof a=="object"&&a!==null||typeof a=="function"}function g(a){return a instanceof d||a instanceof DataView}function i(a){return"ReadableStream"in globalThis&&a instanceof ReadableStream||"WritableStream"in globalThis&&a instanceof WritableStream||"TransformStream"in globalThis&&a instanceof TransformStream}function y(a){return"MessageChannel"in globalThis&&a instanceof MessageChannel}function m(a){return"ArrayBuffer"in globalThis&&a instanceof ArrayBuffer||"MessagePort"in globalThis&&a instanceof MessagePort||"AudioData"in globalThis&&a instanceof p||"ImageBitmap"in globalThis&&a instanceof ImageBitmap||"VideoFrame"in globalThis&&a instanceof T||"OffscreenCanvas"in globalThis&&a instanceof b||"RTCDataChannel"in globalThis&&a instanceof w}function S(a){return Array.from(new Set(a))}function A(a,f=!1,t=1e4){const n=new Set([]);let r=[],s=[a];for(;s.length>0&&t>0;){for(let e of s)if(g(e))n.add(e.buffer);else if(m(e))n.add(e);else if(y(e))n.add(e.port1),n.add(e.port2);else if(f&&i(e))n.add(e);else if(!i(e)&&h(e)){const o=Array.isArray(e)?e:Object.values(e),u=o.length;for(let c=0;c<u;c++)r.push(o[c])}s=r,r=[],t--}return Array.from(n)}function*M(a,f=!1,t=1e4){const n=new Set([]);let r=[a],s=[];for(;r.length>0&&t>0;){for(let e of r)if(!n.has(e)){if(g(e)){n.add(e);const{buffer:o}=e;if(n.has(o))continue;yield o,n.add(o)}else if(m(e))yield e,n.add(e);else if(y(e)){if(n.add(e),n.has(e.port1)||n.has(e.port2))continue;yield e.port1,yield e.port2,n.add(e.port1),n.add(e.port2)}else if(f&&i(e))yield e,n.add(e);else if(!i(e)&&h(e)){const o=Array.isArray(e)?e:Object.values(e),u=o.length;for(let c=0;c<u;c++)s.push(o[c])}}r=s,s=[],t--}return n.clear(),r=null,s=null,null}function O(a,f=!1,t=1e4){let n=[a],r=[];for(;n.length>0&&t>0;){for(let s of n){if(g(s))return!0;if(m(s))return!0;if(y(s))return!0;if(f&&i(s))return!0;if(h(s)&&!i(s)){const e=Array.isArray(s)?s:Object.values(s),o=e.length;for(let u=0;u<o;u++)r.push(e[u])}}n=r,r=[],t--}return n=null,r=null,!1}l.AudioData=p,l.OffscreenCanvas=b,l.RTCDataChannel=w,l.TypedArray=d,l.VideoFrame=T,l.filterOutDuplicates=S,l.getTransferable=M,l.getTransferables=A,l.hasTransferables=O,l.isMessageChannel=y,l.isObject=h,l.isStream=i,l.isSupported=C,l.isTransferable=m,l.isTypedArray=g,Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
